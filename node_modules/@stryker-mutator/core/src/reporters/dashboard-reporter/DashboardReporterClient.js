"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const plugin_1 = require("@stryker-mutator/api/plugin");
const util_1 = require("@stryker-mutator/util");
const tokens_1 = require("./tokens");
const URL_STRYKER_DASHBOARD_REPORTER = 'https://dashboard.stryker-mutator.io/api/reports';
class DashboardReporterClient {
    constructor(log, dashboardReporterClient) {
        this.log = log;
        this.dashboardReporterClient = dashboardReporterClient;
    }
    postStrykerDashboardReport(report) {
        this.log.info(`Posting report to ${URL_STRYKER_DASHBOARD_REPORTER}`);
        const reportString = JSON.stringify(report);
        this.log.debug('Posting data %s', reportString);
        return this.dashboardReporterClient.post(URL_STRYKER_DASHBOARD_REPORTER, reportString, {
            ['Content-Type']: 'application/json'
        })
            .then(body => {
            const statusCode = body.message.statusCode;
            if (statusCode !== 201) {
                this.log.error(`Post to ${URL_STRYKER_DASHBOARD_REPORTER} resulted in http status code: ${statusCode}.`);
            }
        })
            .catch(err => {
            this.log.error(`Unable to reach ${URL_STRYKER_DASHBOARD_REPORTER}. Please check your internet connection.`, util_1.errorToString(err));
        });
    }
}
DashboardReporterClient.inject = plugin_1.tokens(plugin_1.commonTokens.logger, tokens_1.dashboardReporterTokens.httpClient);
exports.default = DashboardReporterClient;
//# sourceMappingURL=DashboardReporterClient.js.map