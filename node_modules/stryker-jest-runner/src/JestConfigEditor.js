"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var CustomJestConfigLoader_1 = require("./configLoaders/CustomJestConfigLoader");
var ReactScriptsJestConfigLoader_1 = require("./configLoaders/ReactScriptsJestConfigLoader");
var ReactScriptsTSJestConfigLoader_1 = require("./configLoaders/ReactScriptsTSJestConfigLoader");
var jestOverrideOptions_1 = require("./jestOverrideOptions");
var plugin_1 = require("stryker-api/plugin");
var DEFAULT_PROJECT_NAME = 'custom';
var DEFAULT_PROJECT_NAME_DEPRECATED = 'default';
var JestConfigEditor = /** @class */ (function () {
    function JestConfigEditor(log) {
        this.log = log;
    }
    JestConfigEditor.prototype.edit = function (strykerConfig) {
        // If there is no Jest property on the Stryker config create it
        strykerConfig.jest = strykerConfig.jest || {};
        if (strykerConfig.jest.project) {
            this.log.warn('DEPRECATED: `jest.project` is renamed to `jest.projectType`. Please change it in your stryker configuration.');
        }
        // When no projectType is set, set it to the default
        strykerConfig.jest.projectType = strykerConfig.jest.projectType || strykerConfig.jest.project || DEFAULT_PROJECT_NAME;
        if (strykerConfig.jest.projectType.toLowerCase() === DEFAULT_PROJECT_NAME_DEPRECATED) {
            this.log.warn("DEPRECATED: The '" + DEFAULT_PROJECT_NAME_DEPRECATED + "' `jest.projectType` is renamed to '" + DEFAULT_PROJECT_NAME + "'. Please rename it in your stryker configuration.");
            strykerConfig.jest.projectType = DEFAULT_PROJECT_NAME;
        }
        // When no config property is set, load the configuration with the project type
        strykerConfig.jest.config = strykerConfig.jest.config || this.getConfigLoader(strykerConfig.jest.projectType).loadConfig();
        // Override some of the config properties to optimise Jest for Stryker
        strykerConfig.jest.config = this.overrideProperties(strykerConfig.jest.config);
    };
    JestConfigEditor.prototype.getConfigLoader = function (projectType) {
        switch (projectType.toLowerCase()) {
            case DEFAULT_PROJECT_NAME:
                return new CustomJestConfigLoader_1.default(process.cwd());
            case 'react':
                return new ReactScriptsJestConfigLoader_1.default(process.cwd());
            case 'react-ts':
                return new ReactScriptsTSJestConfigLoader_1.default(process.cwd());
            default:
                throw new Error("No configLoader available for " + projectType);
        }
    };
    JestConfigEditor.prototype.overrideProperties = function (config) {
        return Object.assign(config, jestOverrideOptions_1.default);
    };
    JestConfigEditor.inject = plugin_1.tokens(plugin_1.commonTokens.logger);
    return JestConfigEditor;
}());
exports.default = JestConfigEditor;
//# sourceMappingURL=JestConfigEditor.js.map